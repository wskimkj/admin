<!DOCTYPE html>
<html lang="ko">
<head>
  <link rel="stylesheet" href="./css/common.css">
  <meta charset="UTF-8" />
  <title>어드민</title>
  <link rel="icon" type="image/png" href="favicon.ico" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root{
      --shell-bg: rgba(255,255,255,0.98);
      --shell-shadow: 0 24px 60px rgba(15,23,42,.22);
      --card-shadow:
        0 18px 40px rgba(148, 163, 184, 0.28),
        inset 0 1px 0 rgba(255,255,255,0.9);
      --card-bg: radial-gradient(circle at top left, #fef3ff 0%, #ffffff 50%, #f1f5f9 100%);

      --main-sidebar-bg: #b79cff; /* 파스텔 퍼플 단색 */

      --nav-text: #f9fafb;
      --nav-chip-bg: rgba(255,255,255,0.18);
      --nav-active-chip-bg: #ffffff;
      --nav-active-color: #6d28d9;

      /* ✅ 서브(하위) 사이드바: 핑크 글라스 */
       --sub-glass-bg: rgba(255, 60, 150, 0.34);   /* 상단 핑크 */
  --sub-glass-bg2: rgba(255, 160, 210, 0.22); /* 하단 라이트핑크 */
  --sub-glass-border: rgba(255, 170, 220, 0.58);
  --sub-glass-shadow: 0 22px 55px rgba(236, 72, 153, 0.22),
                      0 18px 45px rgba(15,23,42,0.18);

  --sub-item-bg: rgba(255, 255, 255, 0.20);
  --sub-item-hover: rgba(255, 255, 255, 0.32)
      --sub-title-color: rgba(255,255,255,0.96);

      /* glass calendar */
      --glass-bg: rgba(255,255,255,0.62);
      --glass-border: rgba(255,255,255,0.70);
      --glass-shadow: 0 18px 50px rgba(15,23,42,0.16);
      --ink: #0f172a;
      --muted: rgba(15,23,42,0.55);
      --accent: #7c3aed;
      --accent2: #ec4899;
    }

    body{
      min-height: 100vh;
      padding: 0;
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background:
        radial-gradient(circle at top left, rgba(236,72,153,.35), transparent 55%),
        radial-gradient(circle at bottom right, rgba(96,165,250,.28), transparent 55%),
        radial-gradient(circle at top right, rgba(124,58,237,.22), transparent 55%),
        #fdf2ff;
      overflow: hidden;
      font-size: 14px;
    }

    .app-shell{
      position: relative;
      width: 100%;
      height: 100vh;
      border-radius: 18px;
      background: var(--shell-bg);
      box-shadow: var(--shell-shadow);
      overflow: hidden;
    }

    /* ===== main sidebar ===== */
    .main-sidebar{
      position:absolute; top:0; left:0;
      width:82px; height:100%;
      background: var(--main-sidebar-bg);
      display:flex; flex-direction:column; align-items:center;
      padding: 16px 0;
      z-index: 50;
    }

    .nav-list{
      flex:1;
      display:flex; flex-direction:column;
      align-items:center;
      gap: 10px;
      margin-top: 4px;
    }

    .nav-item{
      width:60px;
      border:none;
      background:transparent;
      color: var(--nav-text);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 4px;
      cursor:pointer;
      font-size: 11px;
      font-weight: 600;
    }

    .nav-icon-wrap{
      width:40px;height:40px;
      border-radius:18px;
      background: var(--nav-chip-bg);
      display:flex;align-items:center;justify-content:center;
      box-shadow: 0 6px 14px rgba(15,23,42,0.20);
      transition: all .2s ease;
    }

    .nav-item i{ font-size: 20px; }
    .nav-item span{ opacity:.95; }

    .nav-item.active .nav-icon-wrap{
      background: var(--nav-active-chip-bg);
      color: var(--nav-active-color);
      box-shadow: 0 10px 22px rgba(124,58,237,.16);
    }

    .nav-item:hover .nav-icon-wrap{
      transform: translateY(-1px);
      box-shadow: 0 12px 24px rgba(15,23,42,.18);
    }

    /* ===== footer buttons ===== */
    .nav-footer-btn{
      margin-top: auto;
      margin-bottom: 6px;
      border: none;
      background: rgba(255,255,255,0.18);
      color: rgba(255,255,255,0.92);
      border-radius: 999px;
      padding: 8px 10px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      font-weight: 900;
      box-shadow: 0 10px 22px rgba(15,23,42,0.22);
      transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
    }
    .nav-footer-btn i{ font-size: 16px; }
    .nav-footer-btn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,0.26);
      box-shadow: 0 14px 28px rgba(15,23,42,0.22);
    }

    /* ✅ 하위 사이드바(구글시트/유틸): 내용만큼 + 핑크 글라스 + "메인 옆" 위치는 JS로 */
    .sub-sidebar{
      position:absolute;
      left: 96px;          /* 메인(82px) 옆 */
      width: 160px;
      border-radius: 22px;
      padding: 12px 12px 10px;

    background: rgba(255, 255, 255, 0.22); /* 단색 */
   border: 1px solid rgba(255, 255, 255, 0.45);

  /* “살짝 글로우” */
   box-shadow:
    0 18px 40px rgba(15,23,42,0.18),
    inset 0 1px 0 rgba(255,255,255,0.35);

  backdrop-filter: blur(18px);
  -webkit-backdrop-filter: blur(18px);

      height: auto;
      max-height: min(520px, calc(100vh - 40px));
      overflow: hidden;

      display:flex;
      flex-direction:column;

      opacity:0;
      transform: translateX(-12px);
      pointer-events:none;
      transition: all .18s ease;
      z-index: 45;
    }
    .sub-sidebar.visible{
      opacity:1;
      transform: translateX(0);
      pointer-events:auto;
    }
    .sub-title{
      font-size: 12px;
      font-weight: 900;
      color: rgba(255,255,255,0.98);
      text-shadow: 0 8px 18px rgba(15,23,42,0.22);
      margin-bottom: 8px;
      letter-spacing: -0.2px;
    }
    .sub-list{
      display:flex; flex-direction:column;
      gap: 8px;
      overflow-y:auto;
      padding-right: 2px;
    }
    .sub-item{
        border: 1px solid rgba(255, 180, 220, 0.28);
       box-shadow:
    0 10px 20px rgba(15,23,42,0.10),
    inset 0 1px 0 rgba(255,255,255,0.35);

      width:100%;
      padding: 9px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,0.18);
      color: rgba(255,255,255,0.95);
      font-size: 12px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap: 8px;
      transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
      text-align:left;
    }
    .sub-item i{ font-size:16px; }
    .sub-item:hover{
      background: rgba(255,255,255,0.30);
  border-color: rgba(255, 180, 220, 0.40);
  box-shadow:
    0 16px 28px rgba(15,23,42,0.14),
    0 12px 26px rgba(236,72,153,0.18),
    inset 0 1px 0 rgba(255,255,255,0.40);
}
    .sub-item.active{
      background: rgba(255,255,255,0.92);
      color: var(--nav-active-color);
      box-shadow: 0 12px 20px rgba(124,58,237,.16);
    }

    /* ===== main content ===== */
    .content{
      position:absolute;
      top:0; left:82px; right:0; bottom:0;
      padding: 10px 14px 14px;
      z-index: 1;
    }
    .card{
      width:100%;
      height:100%;
      border-radius: 24px;
      background: var(--card-bg);
      box-shadow: var(--card-shadow);
      padding: 10px;
    }
    iframe{
      width:100%;
      height:100%;
      border:none;
      border-radius:16px;
      background: rgba(255,255,255,0.72);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.55);
      box-shadow: 0 10px 26px rgba(15,23,42,.12);
    }

    /* ===== calendar widget (glass) ===== */
    .calendar-widget{
      position:absolute;
      left: 96px;
      bottom: 20px;
      width: 310px;
      border-radius: 24px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      color: var(--ink);
      padding: 12px;
      box-shadow: var(--glass-shadow);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      z-index: 35;

      opacity: 0;
      transform: translateY(12px) scale(0.98);
      pointer-events:none;
      transition: all .22s ease;
    }
    .calendar-widget.visible{
      opacity:1;
      transform: translateY(0) scale(1);
      pointer-events:auto;
    }

    .calendar-header{
      display:flex; align-items:flex-start; justify-content:space-between;
      margin-bottom: 10px;
      gap: 10px;
    }
    .calendar-title{ font-size: 14px; font-weight: 900; letter-spacing: -0.2px; }
    .calendar-left{ display:flex; flex-direction:column; }

    .calendar-right{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap: wrap;
      justify-content:flex-end;
    }

    /* view toggle */
    .cal-view-seg{
      display:flex;
      gap:6px;
      padding: 4px;
      border-radius: 999px;
      background: rgba(255,255,255,0.55);
      border: 1px solid rgba(15,23,42,0.08);
    }
    .cal-view-seg button{
      border:none;
      cursor:pointer;
      font-size: 10px;
      font-weight: 900;
      padding: 6px 10px;
      border-radius: 999px;
      background: transparent;
      color: rgba(15,23,42,0.72);
    }
    .cal-view-seg button.active{
      background: rgba(255,255,255,0.92);
      box-shadow: 0 8px 18px rgba(15,23,42,0.10);
      color: var(--accent);
    }

    /* bell (also sheet link) */
    .today-event-icon{
      position:relative;
      width:30px;height:30px;border-radius:999px;
      background: rgba(255,255,255,0.92);
      display:inline-flex;align-items:center;justify-content:center;
      box-shadow: 0 10px 18px rgba(15,23,42,0.10);
      transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
      cursor: pointer;
      user-select:none;
    }
    .today-event-icon:hover{
      transform: translateY(-1px);
      box-shadow: 0 16px 24px rgba(15,23,42,0.12);
    }
    .today-event-icon i{ font-size:16px; color: var(--accent2); }
    .today-event-icon.dim{ opacity: .75; }
    .today-event-badge{
      position:absolute; top:-4px; right:-4px;
      min-width:16px;height:16px;border-radius:999px;
      background:#ef4444;
      color:#fff;
      border:2px solid rgba(255,255,255,0.9);
      font-size:10px;
      font-weight:900;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 0 5px;
    }

    .calendar-weekdays, .calendar-days{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 4px;
      text-align:center;
    }
    .calendar-weekdays{
      margin: 6px 0 8px;
    }
    .calendar-weekdays span{
      font-size: 10px;
      font-weight: 800;
      color: rgba(15,23,42,0.55);
    }

    .calendar-day{
      position: relative;
      font-size: 11px;
      padding: 7px 0;
      border-radius: 12px;
      color: rgba(15,23,42,0.82);
      user-select:none;
      cursor: pointer;
      background: rgba(255,255,255,0.55);
      border: 1px solid rgba(15,23,42,0.08);
      box-shadow: 0 10px 18px rgba(15,23,42,0.06);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .calendar-day:hover{
      transform: translateY(-1px);
      box-shadow: 0 16px 24px rgba(15,23,42,0.08);
    }
    .calendar-day.other-month{ opacity:.35; cursor: default; }
    .calendar-day.today{
      outline: 2px solid rgba(124,58,237,0.35);
      background: rgba(255,255,255,0.88);
      color: var(--accent);
      font-weight: 900;
    }

    .day-badge{
      position:absolute;
      top:-6px; right:-6px;
      min-width:18px; height:18px;
      padding: 0 6px;
      border-radius: 999px;
      background: rgba(124,58,237,0.92);
      color:#fff;
      border: 2px solid rgba(255,255,255,0.95);
      font-size:9px;
      font-weight:900;
      display:none;
      align-items:center;
      justify-content:center;
      box-shadow: 0 10px 18px rgba(124,58,237,0.20);
    }
    .calendar-day.has-event .day-badge{ display:inline-flex; }

    /* ===== date popup (preview) ===== */
    .date-popup{
      position:absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: calc(100% + 10px);
      width: 300px;
      border-radius: 18px;
      background: rgba(255,255,255,0.88);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      box-shadow: 0 22px 50px rgba(15,23,42,.22);
      border: 1px solid rgba(255,255,255,0.80);
      padding: 10px;
      display:none;
      z-index: 80;
    }
    .date-popup.open{ display:block; }

    .date-popup::after{
      content:"";
      position:absolute;
      bottom:-8px;
      left:50%;
      transform: translateX(-50%);
      border-width: 8px 8px 0 8px;
      border-style: solid;
      border-color: rgba(255,255,255,0.88) transparent transparent transparent;
      filter: drop-shadow(0 6px 10px rgba(15,23,42,0.12));
    }

    .date-popup-head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 8px;
      margin-bottom:8px;
    }
    .date-popup-head strong{
      font-size:13px;
      font-weight:1000;
      color: rgba(15,23,42,0.92);
      letter-spacing: -0.2px;
    }
    .date-popup-close{
      border:none;
      width:30px;height:30px;
      border-radius: 999px;
      cursor:pointer;
      background: rgba(255,255,255,0.92);
      box-shadow: 0 12px 18px rgba(15,23,42,0.10);
      display:flex; align-items:center; justify-content:center;
      color: rgba(15,23,42,0.70);
    }

    .date-popup-list{
      display:flex;
      flex-direction:column;
      gap:8px;
      max-height: 320px;
      overflow:auto;
      padding-right: 4px;
    }

    .mini-event{
      border-radius: 16px;
      padding: 10px;
      background: rgba(255,255,255,0.78);
      border: 1px solid rgba(15,23,42,0.08);
      box-shadow: 0 10px 18px rgba(15,23,42,0.06);
    }
    .mini-event .mall{
      font-size: 11px;
      font-weight: 1000;
      color: var(--accent);
    }

    .mini-event .event-text{
      margin-top: 6px;
      font-size: 10px;
      font-weight: 800;
      color: rgba(15,23,42,0.92);
      line-height: 1.45;
      max-height: 110px;
      overflow: auto;
      padding-right: 6px;
      word-break: break-word;
    }

    .mini-event .meta{
      margin-top: 8px;
      font-size: 10px;
      color: rgba(15,23,42,0.55);
      font-weight: 900;
    }

    /* ===== ITEM(접기/펼치기) ===== */
    .item-box{
      margin-top: 8px;
      padding: 6px 8px;
      border-radius: 12px;
      background: rgba(124,58,237,0.08);
      border: 1px solid rgba(124,58,237,0.18);
    }
    .item-head{
      width: 100%;
      border: none;
      background: transparent;
      cursor: pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 8px;
      padding: 0;
    }
    .item-label{
      font-size: 8px;
      font-weight: 900;
      color: #7c3aed;
    }
    .item-caret{
      font-size: 14px;
      color: rgba(124,58,237,0.85);
      transition: transform .15s ease;
    }
    .item-head[aria-expanded="true"] .item-caret{
      transform: rotate(180deg);
    }
    .item-text{
      margin-top: 6px;
      font-size: 8px;
      line-height: 1.4;
      color: rgba(15,23,42,0.88);
      max-height: 44px;
      overflow: auto;
      word-break: break-word;
      padding-right: 6px;
    }
    .item-text.is-collapsed{ display:none; }

    /* ===== phone widget (glass) ===== */
    .phone-widget{
      position:absolute;
      left: 96px;
      bottom: 20px;
      width: 310px;
      border-radius: 24px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      color: var(--ink);
      padding: 12px;
      box-shadow: var(--glass-shadow);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      z-index: 36;

      opacity: 0;
      transform: translateY(12px) scale(0.98);
      pointer-events:none;
      transition: all .22s ease;
    }
    .phone-widget.visible{
      opacity:1;
      transform: translateY(0) scale(1);
      pointer-events:auto;
    }
    .phone-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom: 10px;
    }
    .phone-title{
      font-size: 14px;
      font-weight: 900;
      letter-spacing: -0.2px;
    }
    .phone-close{
      border:none;
      width:30px;height:30px;
      border-radius:999px;
      cursor:pointer;
      background: rgba(255,255,255,0.92);
      box-shadow: 0 12px 18px rgba(15,23,42,0.10);
      display:flex;align-items:center;justify-content:center;
      color: rgba(15,23,42,0.70);
    }
    .phone-input{
      width:100%;
      border:none;
      outline:none;
      border-radius: 16px;
      padding: 10px 12px;
      background: rgba(255,255,255,0.85);
      border: 1px solid rgba(15,23,42,0.08);
      box-shadow: 0 10px 18px rgba(15,23,42,0.06);
      font-weight: 800;
    }
    .phone-row{
      margin-top: 10px;
      display:flex;
      gap: 8px;
      align-items:center;
    }
    .phone-output{
      flex:1;
      border-radius: 16px;
      padding: 10px 12px;
      background: rgba(255,255,255,0.72);
      border: 1px solid rgba(15,23,42,0.08);
      font-weight: 900;
      color: rgba(15,23,42,0.86);
      user-select: none;
      cursor: copy;
    }
    .phone-copy{
      border:none;
      cursor:pointer;
      border-radius: 16px;
      padding: 10px 12px;
      background: rgba(255,255,255,0.92);
      box-shadow: 0 10px 18px rgba(15,23,42,0.10);
      font-weight: 900;
      color: var(--accent);
    }
    .phone-copy:active{ transform: translateY(1px); }
    .phone-hint{
      margin-top: 8px;
      font-size: 10px;
      font-weight: 800;
      color: rgba(15,23,42,0.55);
    }

    /* ===== account widget (glass) ===== */
    .account-widget{
      position:absolute;
      left: 96px;
      bottom: 20px;
      width: 380px;
      border-radius: 24px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      color: var(--ink);
      padding: 12px;
      box-shadow: var(--glass-shadow);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      z-index: 38;

      opacity: 0;
      transform: translateY(12px) scale(0.98);
      pointer-events:none;
      transition: all .22s ease;
    }
    .account-widget.visible{
      opacity:1;
      transform: translateY(0) scale(1);
      pointer-events:auto;
    }
    .account-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom: 10px;
    }
    .account-title{
      font-size: 14px;
      font-weight: 900;
      letter-spacing: -0.2px;
    }
    .account-close{
      border:none;
      width:30px;height:30px;
      border-radius:999px;
      cursor:pointer;
      background: rgba(255,255,255,0.92);
      box-shadow: 0 12px 18px rgba(15,23,42,0.10);
      display:flex;align-items:center;justify-content:center;
      color: rgba(15,23,42,0.70);
    }
    .account-row{
      display:flex;
      gap: 8px;
      align-items:center;
    }
    .account-input{
      flex: 1;
      border:none;
      outline:none;
      border-radius: 16px;
      padding: 10px 12px;
      background: rgba(255,255,255,0.85);
      border: 1px solid rgba(15,23,42,0.08);
      box-shadow: 0 10px 18px rgba(15,23,42,0.06);
      font-weight: 800;
    }
    .account-search{
      border:none;
      cursor:pointer;
      border-radius: 16px;
      padding: 10px 12px;
      background: rgba(255,255,255,0.92);
      box-shadow: 0 10px 18px rgba(15,23,42,0.10);
      font-weight: 900;
      color: var(--accent);
    }
    .account-search:active{ transform: translateY(1px); }
    .account-toggle{
      margin-top: 8px;
      display:flex;
      align-items:center;
      gap: 8px;
      font-size: 11px;
      font-weight: 900;
      color: rgba(15,23,42,0.60);
      user-select:none;
    }
    .account-toggle input{ accent-color: var(--accent); }
    .account-meta{
      margin-top: 8px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
    }
    .account-badge{
      font-size: 10px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(124,58,237,0.16);
      border: 1px solid rgba(124,58,237,0.22);
      color: var(--accent);
      font-weight: 1000;
      letter-spacing: 0.08em;
    }
    .account-count{
      font-size: 11px;
      font-weight: 1000;
      color: rgba(15,23,42,0.62);
    }
    .account-result{
      margin-top: 8px;
      max-height: 360px;
      overflow:auto;
      padding-right: 4px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }
    .account-card{
      border-radius: 16px;
      padding: 10px;
      background: rgba(255,255,255,0.78);
      border: 1px solid rgba(15,23,42,0.08);
      box-shadow: 0 10px 18px rgba(15,23,42,0.06);
      display:flex;
      flex-direction:column;
      gap: 8px;
      min-width: 0;
    }
    .account-card-head{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap: 8px;
    }
    .account-site{
      font-size: 12px;
      font-weight: 1000;
      color: rgba(15,23,42,0.92);
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      min-width: 0;
      flex: 1;
    }
    .account-group{
      font-size: 10px;
      font-weight: 1000;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(236,72,153,0.14);
      border: 1px solid rgba(236,72,153,0.22);
      color: rgba(236,72,153,0.95);
      white-space: nowrap;
    }
    .account-fields{
      display:flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .account-chip{
      display:flex;
      align-items:center;
      gap: 6px;
      padding: 6px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.92);
      border: 1px solid rgba(15,23,42,0.08);
      box-shadow: 0 6px 12px rgba(15,23,42,0.06);
      min-width: 0;
    }
    .account-chip .k{
      font-size: 9px;
      font-weight: 1000;
      color: rgba(15,23,42,0.55);
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }
    .account-chip .v{
      font-size: 10px;
      font-weight: 1000;
      color: rgba(15,23,42,0.88);
      max-width: 140px;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    }

    .account-empty{
      grid-column: 1 / -1;
      padding: 10px 4px;
      font-size: 12px;
      font-weight: 900;
      color: rgba(15,23,42,0.55);
      text-align:center;
    }
    .account-toast{
      position: absolute;
      left: 50%;
      bottom: 12px;
      transform: translateX(-50%);
      background: rgba(15,23,42,0.92);
      color: #fff;
      font-size: 11px;
      font-weight: 900;
      padding: 7px 12px;
      border-radius: 999px;
      opacity: 0;
      pointer-events:none;
      transition: opacity .16s ease, transform .16s ease;
      box-shadow: 0 14px 28px rgba(15,23,42,0.22);
    }
    .account-toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-2px);
    }
    .account-head-left{
  display:flex;
  flex-direction:column;
  gap: 8px; /* 제목 아래에 버튼이 붙게 */
  align-items:flex-start;
}

/* ACCOUNT 버튼 클릭 가능하게 */
.account-badge-link{
  border: none;
  cursor: pointer;
  user-select:none;
}

.account-badge-link:hover{
  background: rgba(124,58,237,0.20);
  border-color: rgba(124,58,237,0.26);
}

.account-badge-link:active{
  transform: translateY(1px);
}


    @media (max-width: 900px) {
      body{ padding:10px; overflow:auto; }
      .app-shell{ height:auto; min-height: calc(100vh - 20px); }
      .main-sidebar{ position:fixed; height: calc(100vh - 20px); }
      .content{
        position:relative;
        left:82px;
        width: calc(100% - 82px);
        height:auto;
        min-height:70vh;
      }
    }
  </style>
</head>

<body>
<div class="app-shell">

  <!-- main sidebar -->
  <nav class="main-sidebar">
    <div class="nav-list">
      <button class="nav-item active" data-id="search" data-href="https://wskimkj.github.io/search/">
        <div class="nav-icon-wrap"><i class='bx bx-search'></i></div>
        <span> 상품</span>
      </button>

      <button class="nav-item" data-id="template" data-href="https://wskimkj.github.io/trim2/">
        <div class="nav-icon-wrap"><i class='bx bx-message'></i></div>
        <span> 템플릿</span>
      </button>

      <button class="nav-item" data-id="order" data-href="https://wskimkj.github.io/return-inf/">
        <div class="nav-icon-wrap"><i class='bx bx-cart'></i></div>
        <span> 주문 </span>
      </button>

      <button class="nav-item" data-id="memo" data-href="https://wskimkj.github.io/memo/">
        <div class="nav-icon-wrap"><i class='bx bx-pen'></i></div>
        <span> 메모</span>
      </button>

      <!-- ✅ 유틸(하위) -->
      <button class="nav-item" id="utilBtn" data-id="util">
        <div class="nav-icon-wrap"><i class='bx bx-category'></i></div>
        <span> 유틸 </span>
      </button>

      <!-- ✅ 시트(하위) -->
      <button class="nav-item" id="googleBtn" data-id="google">
        <div class="nav-icon-wrap"><i class='bx bx-spreadsheet'></i></div>
        <span> 시트 </span>
      </button>
    </div>

    <button class="nav-footer-btn" id="phoneFormatBtn" type="button" title="전화번호 포맷">
      <i class='bx bx-phone'></i>
      <span>Phone</span>
    </button>

    <!-- ✅ account widget toggle (위젯은 그대로 유지) -->
    <button class="nav-footer-btn" id="accountWidgetBtn" type="button" title="계정 조회">
      <i class='bx bx-key'></i>
      <span>ID/PW</span>
    </button>

    <button class="nav-footer-btn" id="adminEventBtn" type="button" title="이벤트 보기">
      <i class='bx bx-calendar-event'></i>
      <span>event</span>
    </button>
  </nav>

  <!-- ✅ sheet sub sidebar -->
  <aside class="sub-sidebar" id="subSidebar">
    <div class="sub-title">구글 시트</div>
    <div class="sub-list">
      <button class="sub-item google-child" data-href="https://docs.google.com/spreadsheets/d/1_L12NKkBVU4c5xDPrYLUQRnSUG2NoAwYGWIfPDVO3bM/edit?gid=366983013#gid=366983013">
        <i class='bx bx-chevron-right'></i><span>개인시트</span>
      </button>
      <button class="sub-item google-child" data-href="https://docs.google.com/spreadsheets/d/1_Bxfag-90U6u-6JbhxNqeoD9vRns-CpPeXPIJYO1Z5o/edit?gid=1265906605#gid=1265906605">
        <i class='bx bx-chevron-right'></i><span>반품</span>
      </button>
      <button class="sub-item google-child" data-href="https://docs.google.com/spreadsheets/d/1Cjoo-x9lBA5pFtGoxftdAxdoKrzt770XcPGeXOidPiI/edit?gid=0#gid=0">
        <i class='bx bx-chevron-right'></i><span>Team.반품</span>
      </button>
      <button class="sub-item google-child" data-href="https://docs.google.com/spreadsheets/d/1LPy69E2yPTaSwxFAYrX6qV0BZx1tW0YdonLRNqeo5Vc/edit?gid=0#gid=0">
        <i class='bx bx-chevron-right'></i><span>Team.물류</span>
      </button>
      <button class="sub-item google-child" data-href="https://docs.google.com/spreadsheets/d/1cAXTlsGoK8FNEZ-7PaR7dfLjykPfCqLOIcyBqqdu3wY/edit?gid=925106579#gid=925106579">
        <i class='bx bx-chevron-right'></i><span>Team.업무</span>
      </button>
      <button class="sub-item google-child" data-href="https://docs.google.com/spreadsheets/d/1dvTCc9JlORbvc29rQ_ai-z8RQSPibQUPHvjrH4iuhFk/edit?gid=1184149787#gid=1184149787">
        <i class='bx bx-chevron-right'></i><span>Team.주간</span>
      </button>
    </div>
  </aside>

  <!-- ✅ util sub sidebar -->
  <aside class="sub-sidebar" id="utilSidebar">
    <div class="sub-title">유틸</div>
    <div class="sub-list">
      <!-- ✅ 계정: 기존 account 페이지로 이동 -->
      <button class="sub-item util-child" data-href="https://wskimkj.github.io/account/">
        <i class='bx bx-chevron-right'></i><span>계정</span>
      </button>

      <!-- ✅ 배송조회: 기존 tracking -->
      <button class="sub-item util-child" data-href="https://wskimkj.github.io/tracking/">
        <i class='bx bx-chevron-right'></i><span>배송조회</span>
      </button>

      <!-- ✅ 환불: 기존 refund24 -->
      <button class="sub-item util-child" data-href="https://wskimkj.github.io/refund24/">
        <i class='bx bx-chevron-right'></i><span>환불</span>
      </button>

      <!-- ✅ 이벤트: 위젯 토글 -->
      <button class="sub-item util-child" data-action="event">
        <i class='bx bx-chevron-right'></i><span>이벤트</span>
      </button>
    </div>
  </aside>

  <!-- main content -->
  <div class="content">
    <div class="card">
      <iframe src="https://wskimkj.github.io/search/" id="mainFrame"></iframe>
    </div>
  </div>

  <!-- phone widget -->
  <div class="phone-widget" id="phoneWidget">
    <div class="phone-head">
      <div class="phone-title">Phone</div>
      <button class="phone-close" id="phoneClose" type="button" aria-label="닫기">
        <i class='bx bx-x' style="font-size:18px;"></i>
      </button>
    </div>

    <div class="phone-body">
      <input id="phoneInput" class="phone-input" placeholder="" />
      <div class="phone-row">
        <div id="phoneOutput" class="phone-output"></div>
        <button id="phoneCopy" class="phone-copy" type="button">복사</button>
      </div>
      <div id="phoneHint" class="phone-hint">.</div>
    </div>
  </div>

  <!-- ✅ account widget -->
<div class="account-widget" id="accountWidget">
  <div class="account-head">
    <div class="account-head-left">
      <div class="account-title">계정 조회</div>

      <!-- ✅ ACCOUNT 버튼: 화살표 위치로 이동 -->
      <button type="button" class="account-badge account-badge-link" id="accountSheetBtn">
        ACCOUNT
      </button>
    </div>

    <button class="account-close" id="accountClose" type="button" aria-label="닫기">
      <i class='bx bx-x' style="font-size:18px;"></i>
    </button>
  </div>

  <div class="account-body">
    <div class="account-row">
      <input id="accountQuery" class="account-input" placeholder="" />
    </div>

    <label class="account-toggle" title="기본은 OR, 체크하면 AND">
      <input id="accountMatchAll" type="checkbox" />
      ALL
    </label>

    <!-- ✅ meta에는 count만 남김 -->
    <div class="account-meta">
      <span></span>
      <span id="accountCount" class="account-count">0건</span>
    </div>

    <div id="accountResult" class="account-result">
      <div class="account-empty">데이터 불러오는 중...</div>
    </div>

    <div id="accountToast" class="account-toast">복사</div>
  </div>
</div>


  <!-- calendar widget -->
  <div class="calendar-widget" id="calendarWidget">
    <div class="calendar-header">
      <div class="calendar-left">
        <div class="calendar-title" id="calendarMonthLabel">December 2025</div>
      </div>

      <div class="calendar-right">
        <div class="cal-view-seg" id="calViewSeg">
          <button type="button" data-view="week">주</button>
          <button type="button" data-view="month">월</button>
        </div>

        <div class="today-event-icon dim" id="todayEventIcon" title="이벤트 시트 열기">
          <i class='bx bx-bell'></i>
          <div class="today-event-badge" id="todayBadge"></div>
        </div>
      </div>
    </div>

    <div class="date-popup" id="datePopup">
      <div class="date-popup-head">
        <strong id="popupDateLabel">12/15(월)</strong>
        <button class="date-popup-close" id="popupClose" type="button" aria-label="닫기">
          <i class='bx bx-x' style="font-size:18px;"></i>
        </button>
      </div>
      <div class="date-popup-list" id="popupEventList"></div>
    </div>

    <div class="calendar-weekdays">
      <span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span>
    </div>
    <div class="calendar-days" id="calendarDays"></div>
  </div>
</div>

<script>
  /* ======================
     Helpers
     ====================== */
  function pad2(n){ return String(n).padStart(2, "0"); }
  function dateKeyLocal(d){
    return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
  }

  function normalizeToKey(value){
    if(!value) return null;
    let s = String(value).trim();
    s = s.replace(/\([^)]+\)/g, "");
    s = s.replace(/\s+/g, "");

    const ymd = s.match(/^(\d{4})[\/\-.](\d{1,2})[\/\-.](\d{1,2})$/);
    if(ymd){
      return `${ymd[1]}-${String(ymd[2]).padStart(2,"0")}-${String(ymd[3]).padStart(2,"0")}`;
    }

    const md = s.match(/^(\d{1,2})[\/\-.](\d{1,2})$/);
    if(md){
      const year = new Date().getFullYear();
      return `${year}-${pad2(Number(md[1]))}-${pad2(Number(md[2]))}`;
    }

    const d = new Date(s);
    if(!isNaN(d)) return dateKeyLocal(d);
    return null;
  }

  function inRangeKey(dayKey, startKey, endKey){
    return dayKey >= startKey && dayKey <= endKey;
  }

  const KOR_DOW = ["일","월","화","수","목","금","토"];
  function formatMDKorean(dateKey){
    const [y,m,d] = dateKey.split("-").map(Number);
    const dt = new Date(y, m-1, d);
    return `${pad2(m)}/${pad2(d)}(${KOR_DOW[dt.getDay()]})`;
  }

  function formatBulletLines(text){
    const s = String(text ?? "");
    return s
      .replace(/\s*■\s*/g, "\n■ ")
      .replace(/\n{3,}/g, "\n\n")
      .trim();
  }

  function escapeHtml(str){
    return String(str ?? "")
      .replace(/&/g,"&amp;")
      .replace(/</g,"&lt;")
      .replace(/>/g,"&gt;")
      .replace(/"/g,"&quot;")
      .replace(/'/g,"&#039;");
  }

  function textToHtmlWithBreaks(text){
    const safe = escapeHtml(String(text ?? ""));
    return safe.replace(/\r\n|\r|\n/g, "<br>");
  }

  function cleanTarget(raw){
    let t = String(raw ?? "").trim();
    t = t.replace(/^"+|"+$/g, "").trim();
    if(t === '""') t = "";
    return t;
  }

  /* ======================
     DOM
     ====================== */
  const phoneWidget = document.getElementById("phoneWidget");
  const phoneFormatBtn = document.getElementById("phoneFormatBtn");
  const phoneClose = document.getElementById("phoneClose");
  const phoneInput = document.getElementById("phoneInput");
  const phoneOutput = document.getElementById("phoneOutput");
  const phoneCopy = document.getElementById("phoneCopy");
  const phoneHint = document.getElementById("phoneHint");

  const accountWidget = document.getElementById("accountWidget");
  const accountWidgetBtn = document.getElementById("accountWidgetBtn");
  const accountClose = document.getElementById("accountClose");
  const accountQuery = document.getElementById("accountQuery");
  const accountSearchBtn = document.getElementById("accountSearchBtn");
  const accountMatchAll = document.getElementById("accountMatchAll");
  const accountResult = document.getElementById("accountResult");
  const accountCount = document.getElementById("accountCount");
  const accountToast = document.getElementById("accountToast");

  const mainFrame = document.getElementById("mainFrame");
  const navItems = document.querySelectorAll(".nav-item");

  const subSidebar = document.getElementById("subSidebar");       // 시트
  const googleBtn = document.getElementById("googleBtn");
  const googleChildren = document.querySelectorAll(".google-child");

  const utilSidebar = document.getElementById("utilSidebar");     // 유틸
  const utilBtn = document.getElementById("utilBtn");
  const utilChildren = document.querySelectorAll(".util-child");

  const calendarWidget = document.getElementById("calendarWidget");
  const adminEventBtn = document.getElementById("adminEventBtn");
  const calViewSeg = document.getElementById("calViewSeg");

  const todayIcon = document.getElementById("todayEventIcon");
  const todayBadge = document.getElementById("todayBadge");

  const popup = document.getElementById("datePopup");
  const popupList = document.getElementById("popupEventList");
  const popupLabel = document.getElementById("popupDateLabel");
  const popupClose = document.getElementById("popupClose");

  const EVENT_SHEET_URL =
    "https://docs.google.com/spreadsheets/d/1Cjoo-x9lBA5pFtGoxftdAxdoKrzt770XcPGeXOidPiI/edit?pli=1&gid=1830278768#gid=1830278768";

  const accountSheetBtn = document.getElementById("accountSheetBtn");

const ACCOUNT_SHEET_URL =
  "https://docs.google.com/spreadsheets/d/1bdGBLki_3CVaq7BDL3u-pQDSZVBD7roeEdsyP-74Lz0/edit?gid=0#gid=0";

accountSheetBtn.addEventListener("click", (e) => {
  window.open(ACCOUNT_SHEET_URL, "_blank");
  e.stopPropagation();
});


  /* ======================
     iframe refresh restore
     ====================== */
  const LAST_FRAME_KEY = "lastFrameURL";
  function restoreLastFrame(){
    const last = localStorage.getItem(LAST_FRAME_KEY);
    mainFrame.src = last ? last : "https://wskimkj.github.io/search/";
  }
  function rememberFrame(url){ localStorage.setItem(LAST_FRAME_KEY, url); }
  restoreLastFrame();

  mainFrame.addEventListener("load", () => {
    rememberFrame(mainFrame.src);
    try{
      const real = mainFrame.contentWindow.location.href;
      if(real) rememberFrame(real);
    }catch{}
  });

  /* ======================
     UI helpers (close)
     ====================== */
  function closePopup(){ popup.classList.remove("open"); }
  function hideCalendar(){ calendarWidget.classList.remove("visible"); }
  function hidePhone(){ phoneWidget.classList.remove("visible"); }
  function hideAccount(){ accountWidget.classList.remove("visible"); }

  function hideAllSubSidebars(){
    subSidebar.classList.remove("visible");
    utilSidebar.classList.remove("visible");
  }

  function closeAllPanels(){
    hideAllSubSidebars();
    hideCalendar();
    hidePhone();
    hideAccount();
    closePopup();
  }

  /* ======================
     ✅ Sub-sidebar positioning (그룹 느낌: 버튼 옆에 딱)
     ====================== */
  function placeSubSidebarNear(btn, panel){
    const r = btn.getBoundingClientRect();
    const left = 96; // main sidebar 옆

    const h = panel.offsetHeight || 220;
    let top = r.top + window.scrollY + (r.height/2) - (h/2);

    const minTop = 12 + window.scrollY;
    const maxTop = window.scrollY + window.innerHeight - h - 12;
    top = Math.max(minTop, Math.min(top, maxTop));

    panel.style.left = left + "px";
    panel.style.top  = top  + "px";
  }

  function showSubSidebar(panel, anchorBtn){
    panel.classList.add("visible");
    requestAnimationFrame(()=> placeSubSidebarNear(anchorBtn, panel));
  }

  /* ======================
     Phone widget
     ====================== */
  function formatKoreanPhone(input){
    let num = String(input ?? "").replace(/\D/g, "");
    if(num.startsWith("82")) num = "0" + num.slice(2);

    const SAFE_PREFIX = ["0502","0504","0505","0506","0507"];
    for(const p of SAFE_PREFIX){
      if(num.startsWith(p)){
        if(num.length === 11){
          return { type:"safe", value: num.replace(/(\d{4})(\d{3})(\d{4})/, "$1-$2-$3") };
        }
        if(num.length === 12){
          return { type:"safe", value: num.replace(/(\d{4})(\d{4})(\d{4})/, "$1-$2-$3") };
        }
      }
    }

    if(num.length === 10 && num.startsWith("10")) num = "0" + num;
    if(num.length === 11 && num.startsWith("010")){
      return { type:"mobile", value: num.replace(/(\d{3})(\d{4})(\d{4})/, "$1-$2-$3") };
    }
    return { type:"unknown", value:"" };
  }

  function togglePhone(){
    const v = phoneWidget.classList.contains("visible");
    if(v){
      hidePhone();
    }else{
      phoneWidget.classList.add("visible");
      hideCalendar();
      hideAllSubSidebars();
      hideAccount();
      closePopup();
      phoneInput.focus();
    }
  }

  phoneFormatBtn.addEventListener("click",(e)=>{
    togglePhone();
    e.stopPropagation();
  });
  phoneClose.addEventListener("click",(e)=>{
    hidePhone();
    e.stopPropagation();
  });
  phoneWidget.addEventListener("click",(e)=> e.stopPropagation());
  phoneWidget.addEventListener("mouseleave", () => hidePhone());

  phoneInput.addEventListener("input", ()=>{
    const result = formatKoreanPhone(phoneInput.value);
    if(result.value){
      phoneOutput.textContent = result.value;
      phoneHint.textContent = (result.type === "safe") ? "안전번호 (가상번호)" : "휴대폰 번호";
    }else{
      phoneOutput.textContent = "010-0000-0000";
      phoneHint.textContent = "번호를 입력하세요";
    }
  });

  async function copyText(v){
    if(!v || v === "010-0000-0000") return;
    try{
      await navigator.clipboard.writeText(v);
      phoneHint.textContent = "복사됨 ✅";
    }catch{
      phoneHint.textContent = "복사 실패(브라우저 권한 확인)";
    }
  }
  phoneOutput.addEventListener("click",(e)=>{
    e.preventDefault(); e.stopPropagation();
    copyText(phoneOutput.textContent);
  });
  phoneCopy.addEventListener("click",(e)=>{
    e.preventDefault(); e.stopPropagation();
    copyText(phoneOutput.textContent);
  });

  /* ======================
     Account widget (existing)
     ====================== */
  const ACCOUNT_SHEET_ID = "1bdGBLki_3CVaq7BDL3u-pQDSZVBD7roeEdsyP-74Lz0";
  const SHOP_GIDS = [0, 618725932, 1481873109];
  const OTHER_GID = 267581891;

  let SHOP_SITES = [];
  let OTHER_SITES = [];
  let accountLoaded = false;

  function accountCsvUrl(gid){
    return `https://docs.google.com/spreadsheets/d/${ACCOUNT_SHEET_ID}/export?format=csv&gid=${gid}`;
  }

  function parseCsv(text){
    const rows = [];
    let row = [];
    let cur = "";
    let inQuotes = false;

    for (let i = 0; i < text.length; i++) {
      const ch = text[i];
      const next = text[i + 1];

      if (ch === '"') {
        if (inQuotes && next === '"') { cur += '"'; i++; }
        else inQuotes = !inQuotes;
        continue;
      }

      if (!inQuotes && ch === ",") { row.push(cur); cur = ""; continue; }

      if (!inQuotes && (ch === "\n" || ch === "\r")) {
        if (ch === "\r" && next === "\n") i++;
        row.push(cur);
        if (row.some(c => (c || "").toString().trim() !== "")) rows.push(row);
        row = [];
        cur = "";
        continue;
      }

      cur += ch;
    }

    if (cur.length > 0 || row.length > 0) {
      row.push(cur);
      if (row.some(c => (c || "").toString().trim() !== "")) rows.push(row);
    }

    return rows;
  }

  async function fetchCsv(gid){
    const res = await fetch(accountCsvUrl(gid), { cache:"no-store" });
    if(!res.ok) throw new Error("csv fetch failed");
    const text = await res.text();
    return parseCsv(text);
  }

  function splitAgKeywords(v){
    return (v || "").toString().split(",").map(s=>s.trim()).filter(Boolean);
  }
  function splitQueryKeywords(q){
    return (q || "").toString().split(/[,\s]+/g).map(s=>s.trim()).filter(Boolean);
  }
  function normalize(s){ return (s || "").toString().toLowerCase().trim(); }

  function tokenMatchAny(agTokens, queryTokens){
    const a = (agTokens || []).map(normalize).filter(Boolean);
    const q = (queryTokens || []).map(normalize).filter(Boolean);
    if(!a.length || !q.length) return false;
    return q.some(qt => a.some(at => at.includes(qt)));
  }
  function tokenMatchAll(agTokens, queryTokens){
    const a = (agTokens || []).map(normalize).filter(Boolean);
    const q = (queryTokens || []).map(normalize).filter(Boolean);
    if(!a.length || !q.length) return false;
    return q.every(qt => a.some(at => at.includes(qt)));
  }

  async function loadAccountData(){
    accountResult.innerHTML = '<div class="account-empty">데이터 불러오는 중...</div>';
    accountCount.textContent = "";

    try{
      const shopPromises = SHOP_GIDS.map(gid => fetchCsv(gid));
      const shopSheetsRows = await Promise.all(shopPromises);

      SHOP_SITES = [];

      shopSheetsRows.forEach((rows, idx)=>{
        const gid = SHOP_GIDS[idx];
        if(!rows || rows.length <= 1) return;

        let groupLabel = (gid === 0) ? "JH" : (gid === 618725932) ? "NH" : (gid === 1481873109) ? "HTY" : "기타";

        rows.slice(1).forEach(cols=>{
          const colA = (cols[0] || "").toString().trim();
          if(colA === "매장") return;

          const ag = cols[32] || "";
          const agKeywords = splitAgKeywords(ag);
          if(!agKeywords.length) return;

          let storeId = "", loginId = "", pw = "";
          if(gid === 0 || gid === 618725932){
            storeId = cols[13];
            loginId = cols[14];
            pw      = cols[15];
          }else if(gid === 1481873109){
            storeId = cols[12];
            loginId = cols[13];
            pw      = cols[14];
          }

          SHOP_SITES.push({
            group: groupLabel,
            siteName: ag || "",
            agKeywords,
            storeId: storeId || "",
            loginId: loginId || "",
            pw: pw || ""
          });
        });
      });

      OTHER_SITES = [];
      if(OTHER_GID != null){
        const otherRows = await fetchCsv(OTHER_GID);
        if(otherRows && otherRows.length > 1){
          otherRows.slice(1).forEach(cols=>{
            const colA = (cols[0] || "").toString().trim();
            if(colA === "매장") return;

            const siteName = cols[0];
            const loginId  = cols[3];
            const pw       = cols[4];
            if(!siteName) return;

            OTHER_SITES.push({
              group: "기타",
              siteName: siteName || "",
              agKeywords: splitAgKeywords(siteName),
              storeId: "",
              loginId: loginId || "",
              pw: pw || ""
            });
          });
        }
      }

      accountLoaded = true;
      accountResult.innerHTML = '<div class="account-empty">검색어를 입력하세요.</div>';
      accountCount.textContent = "0건";
    }catch(err){
      console.error(err);
      accountLoaded = false;
      accountResult.innerHTML =
        '<div class="account-empty">데이터를 불러오지 못했습니다. (시트 공개 권한 확인 필요)</div>';
      accountCount.textContent = "";
    }
  }

  function searchAccountSites(query, matchAll){
    const queryTokens = splitQueryKeywords(query);
    if(!queryTokens.length) return [];
    const matcher = matchAll ? tokenMatchAll : tokenMatchAny;

    const results = [];
    SHOP_SITES.forEach(item=>{
      if(matcher(item.agKeywords, queryTokens)){
        results.push({
          group: item.group || "기타",
          siteName: item.siteName || "",
          storeId: item.storeId || "",
          loginId: item.loginId || "",
          pw: item.pw || ""
        });
      }
    });

    OTHER_SITES.forEach(item=>{
      if(matcher(item.agKeywords, queryTokens)){
        results.push({
          group: item.group || "기타",
          siteName: item.siteName || "",
          storeId: "",
          loginId: item.loginId || "",
          pw: item.pw || ""
        });
      }
    });

    results.sort((a,b)=>(a.siteName||"").localeCompare(b.siteName||""));
    return results;
  }

  let accountToastTimer = null;
  function showAccountToast(){
    accountToast.classList.add("show");
    if(accountToastTimer) clearTimeout(accountToastTimer);
    accountToastTimer = setTimeout(()=> accountToast.classList.remove("show"), 1100);
  }

  function copyToClipboard(text){
    if(!text) return;
    if(navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(text).then(showAccountToast).catch(()=>{});
    }else{
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      try{ document.execCommand("copy"); showAccountToast(); }catch{}
      document.body.removeChild(ta);
    }
  }

function makeAccountChip(label, value){
  const chip = document.createElement("div");
  chip.className = "account-chip";

  const k = document.createElement("div");
  k.className = "k";
  k.textContent = label;

  const v = document.createElement("div");
  v.className = "v";
  v.textContent = value;

  chip.appendChild(k);
  chip.appendChild(v);

  // ✅ 칩(셀) 클릭 → 값 복사
  chip.addEventListener("click", (e)=>{
    e.stopPropagation();
    copyToClipboard(value);
  });

  // ✅ UX: 마우스 올리면 클릭 가능 느낌
  chip.style.cursor = "pointer";

  return chip;
}


  function renderAccountResults(list){
    if(!list || list.length === 0){
      accountResult.innerHTML = '<div class="account-empty">검색 결과가 없습니다.</div>';
      accountCount.textContent = "0건";
      return;
    }

    accountCount.textContent = list.length + "건";
    accountResult.innerHTML = "";
    const frag = document.createDocumentFragment();

    list.forEach(item=>{
      const card = document.createElement("div");
      card.className = "account-card";

      const head = document.createElement("div");
      head.className = "account-card-head";

      const site = document.createElement("div");
      site.className = "account-site";
      site.textContent = item.siteName || "(사이트명 없음)";

      const grp = document.createElement("div");
      grp.className = "account-group";
      grp.textContent = (item.group || "기타").toUpperCase();

      head.appendChild(site);
      head.appendChild(grp);

      const fields = document.createElement("div");
      fields.className = "account-fields";

      const store = (item.storeId || "").toString().trim();
      const hasStore = store !== "" && store !== "-" && store !== "없음";
      if(hasStore) fields.appendChild(makeAccountChip("상점", item.storeId));
      if(item.loginId) fields.appendChild(makeAccountChip("ID", item.loginId));
      if(item.pw) fields.appendChild(makeAccountChip("PW", item.pw));

      card.appendChild(head);
      card.appendChild(fields);
      frag.appendChild(card);
    });

    accountResult.appendChild(frag);
  }

  function doAccountSearch(){
    if(!accountLoaded){
      accountResult.innerHTML = '<div class="account-empty">아직 데이터 로딩 중입니다.</div>';
      accountCount.textContent = "";
      return;
    }
    const q = accountQuery.value.trim();
    if(!q){
      accountResult.innerHTML = '<div class="account-empty">검색어를 입력하세요.</div>';
      accountCount.textContent = "0건";
      return;
    }
    const results = searchAccountSites(q, !!accountMatchAll.checked);
    renderAccountResults(results);
  }

  function toggleAccount(){
    const v = accountWidget.classList.contains("visible");
    if(v){
      hideAccount();
    }else{
      accountWidget.classList.add("visible");
      hideCalendar();
      hideAllSubSidebars();
      hidePhone();
      closePopup();

      if(!accountLoaded){
        loadAccountData();
      }
      accountQuery.focus();
    }
  }

  accountWidgetBtn.addEventListener("click",(e)=>{
    toggleAccount();
    e.stopPropagation();
  });
  accountClose.addEventListener("click",(e)=>{
    hideAccount();
    e.stopPropagation();
  });
  accountWidget.addEventListener("click",(e)=> e.stopPropagation());
  accountWidget.addEventListener("mouseleave", ()=> hideAccount());

  accountSearchBtn.addEventListener("click", doAccountSearch);
  accountQuery.addEventListener("keydown",(e)=>{
    if(e.key === "Enter") doAccountSearch();
  });
  accountMatchAll.addEventListener("change", ()=>{
    if(accountQuery.value.trim()) doAccountSearch();
  });

  /* ======================
     Nav + sub sidebars + calendar
     ====================== */
  function toggleCalendar(){
    const v = calendarWidget.classList.contains("visible");
    if(v) { calendarWidget.classList.remove("visible"); closePopup(); }
    else{
      calendarWidget.classList.add("visible");
      hideAllSubSidebars();
      hidePhone();
      hideAccount();
      buildCalendar();
    }
  }

  adminEventBtn.addEventListener("click",(e)=>{
    toggleCalendar();
    e.stopPropagation();
  });

  // ✅ 시트 토글(버튼 옆에 딱)
  googleBtn.addEventListener("click",(e)=>{
    const isOpen = subSidebar.classList.contains("visible");
    closeAllPanels();
    if(!isOpen){
      showSubSidebar(subSidebar, googleBtn);
    }
    e.stopPropagation();
  });

  // ✅ 유틸 토글(버튼 옆에 딱)
  utilBtn.addEventListener("click",(e)=>{
    const isOpen = utilSidebar.classList.contains("visible");
    closeAllPanels();
    if(!isOpen){
      showSubSidebar(utilSidebar, utilBtn);
    }
    e.stopPropagation();
  });

  // ✅ 메인 nav 일반 이동(유틸/시트는 제외)
  navItems.forEach(btn=>{
    btn.addEventListener("click",(e)=>{
      const id = btn.dataset.id;
      const href = btn.dataset.href;

      if(id === "google" || id === "util"){
        // 토글은 위에서 처리
        e.stopPropagation();
        return;
      }

      navItems.forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");

      closeAllPanels();

      if(href){
        mainFrame.src = href;
        rememberFrame(href);
      }
      e.stopPropagation();
    });
  });

  // ✅ 구글 시트 하위 클릭
  googleChildren.forEach(btn=>{
    btn.addEventListener("click",(e)=>{
      googleChildren.forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");

      const url = btn.dataset.href;
      if(url){
        mainFrame.src = url;
        rememberFrame(url);
      }
      // 서브는 닫아도 되고 유지해도 되는데, 보통 클릭 후 닫는게 깔끔
      closeAllPanels();
      e.stopPropagation();
    });
  });

  // ✅ 유틸 하위 클릭
  utilChildren.forEach(btn=>{
    btn.addEventListener("click",(e)=>{
      utilChildren.forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");

      const action = btn.dataset.action;
      const url = btn.dataset.href;

      if(action === "event"){
        toggleCalendar();
      }else if(url){
        mainFrame.src = url;
        rememberFrame(url);
        closeAllPanels();
      }
      e.stopPropagation();
    });
  });

  document.addEventListener("keydown",(e)=>{
    if(e.key === "Escape"){
      closeAllPanels();
      hideAllSubSidebars();
    }
  });

  popupClose.addEventListener("click",(e)=>{
    closePopup();
    e.stopPropagation();
  });

  todayIcon.addEventListener("click",(e)=>{
    window.open(EVENT_SHEET_URL, "_blank");
    e.stopPropagation();
  });

  // ITEM 토글
  document.addEventListener("click", (e)=>{
    const btn = e.target.closest("[data-itemtoggle]");
    if(!btn) return;

    e.stopPropagation();

    const box = btn.closest("[data-itembox]");
    const content = box?.querySelector("[data-itemcontent]");
    if(!content) return;

    const expanded = btn.getAttribute("aria-expanded") === "true";
    btn.setAttribute("aria-expanded", String(!expanded));
    content.classList.toggle("is-collapsed", expanded ? true : false);
  });

  // ✅ 바깥 클릭하면 서브 사이드바 닫기(그룹 느낌 유지)
  document.addEventListener("click", (e)=>{
    const t = e.target;
    const clickedGoogle = googleBtn.contains(t) || subSidebar.contains(t);
    const clickedUtil   = utilBtn.contains(t) || utilSidebar.contains(t);

    const clickedInsideCalendar = calendarWidget.contains(t) || adminEventBtn.contains(t);
    const clickedInsidePhone = phoneWidget.contains(t) || phoneFormatBtn.contains(t);
    const clickedInsideAccount = accountWidget.contains(t) || accountWidgetBtn.contains(t);

    if(!clickedGoogle && !clickedUtil && !clickedInsideCalendar && !clickedInsidePhone && !clickedInsideAccount){
      hideAllSubSidebars();
    }
  });

  /* ======================
     calendar view mode
     ====================== */
  const CAL_VIEW_KEY = "calendarViewMode";
  let calendarViewMode = localStorage.getItem(CAL_VIEW_KEY) || "week";

  function applyViewSeg(){
    [...calViewSeg.querySelectorAll("button")].forEach(b=>{
      b.classList.toggle("active", b.dataset.view === calendarViewMode);
    });
  }
  applyViewSeg();

  calViewSeg.addEventListener("click",(e)=>{
    const btn = e.target.closest("button");
    if(!btn) return;
    calendarViewMode = btn.dataset.view;
    localStorage.setItem(CAL_VIEW_KEY, calendarViewMode);
    applyViewSeg();
    closePopup();
    buildCalendar();
    e.stopPropagation();
  });

  /* ======================
     Load events from sheet (C~G)
     ====================== */
  let events = [];

  const SHEET_ID = "1Cjoo-x9lBA5pFtGoxftdAxdoKrzt770XcPGeXOidPiI";
  const SHEET_GID = "1830278768";
  const SHEET_CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&gid=${SHEET_GID}`;

  function parseCSV(text){
    const rows = [];
    let row = [], cur = "", inQ = false;
    if(text && text.charCodeAt(0) === 0xFEFF) text = text.slice(1);

    for(let i=0;i<text.length;i++){
      const ch = text[i];
      const next = text[i+1];

      if(ch === '"' && next === '"'){ cur += '"'; i++; continue; }
      if(ch === '"'){ inQ = !inQ; continue; }

      if(ch === ',' && !inQ){ row.push(cur); cur=""; continue; }

      if((ch === '\n' || ch === '\r') && !inQ){
        if(cur.length || row.length){ row.push(cur); rows.push(row); }
        cur=""; row=[];
        continue;
      }
      cur += ch;
    }
    if(cur.length || row.length){ row.push(cur); rows.push(row); }
    return rows;
  }

  async function loadEventsFromSheet(){
    try{
      const res = await fetch(SHEET_CSV_URL, { cache:"no-store" });
      if(!res.ok) throw new Error(`sheet fetch failed (${res.status})`);
      const csv = await res.text();
      const rows = parseCSV(csv);

      const parsed = [];
      for(const r of rows){
        const mall    = (r[2] || "").trim(); // C
        const startV  = (r[3] || "").trim(); // D
        const endV    = (r[4] || "").trim(); // E
        const content = (r[5] || "").trim(); // F
        const target  = cleanTarget(r[6] || ""); // G

        if(!mall && !startV && !endV && !content && !target) continue;

        const startKey = normalizeToKey(startV);
        const endKey   = normalizeToKey(endV);
        if(!mall || !startKey || !endKey) continue;
        if(startKey > endKey) continue;

        parsed.push({ mall, start: startKey, end: endKey, content, target });
      }

      events = parsed;
      buildCalendar();
      updateTodayBadge();
    }catch(err){
      events = [];
      buildCalendar();
      updateTodayBadge();
    }
  }

  function updateTodayBadge(){
    const todayKey = dateKeyLocal(new Date());
    const count = events.filter(ev => inRangeKey(todayKey, ev.start, ev.end)).length;

    if(count > 0){
      todayIcon.classList.remove("dim");
      todayBadge.style.display = "inline-flex";
      todayBadge.textContent = String(count);
    }else{
      todayIcon.classList.add("dim");
      todayBadge.style.display = "none";
      todayBadge.textContent = "";
    }
  }

  function openPopupForDate(dateKey){
    const items = events.filter(ev => inRangeKey(dateKey, ev.start, ev.end));
    popupLabel.textContent = formatMDKorean(dateKey);

    popupList.innerHTML = items.length
      ? items.map(ev=>{
          const pretty = formatBulletLines(ev.content || "(내용없음)");
          const hasItem = !!(ev.target && ev.target.trim());

          return `
            <div class="mini-event">
              <div class="mall">${escapeHtml(ev.mall)}</div>
              <div class="event-text">${textToHtmlWithBreaks(pretty)}</div>

              ${hasItem ? `
                <div class="item-box" data-itembox>
                  <button type="button" class="item-head" data-itemtoggle aria-expanded="false">
                    <span class="item-label">ITEM</span>
                    <i class='bx bx-chevron-down item-caret'></i>
                  </button>
                  <div class="item-text is-collapsed" data-itemcontent>
                    ${escapeHtml(ev.target)}
                  </div>
                </div>
              ` : ``}

              <div class="meta">${escapeHtml(ev.start)} ~ ${escapeHtml(ev.end)}</div>
            </div>
          `;
        }).join("")
      : `<div style="font-size:11px;color:rgba(15,23,42,0.62);font-weight:800;padding:6px 2px;">이날 이벤트 없음</div>`;

    popup.classList.add("open");
  }

  function buildCalendar(){
    if(calendarViewMode === "month") buildCalendarMonth();
    else buildCalendarWeek();
  }

  function buildCalendarWeek(){
    const today = new Date();
    const todayKey = dateKeyLocal(today);

    const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
    document.getElementById("calendarMonthLabel").textContent = `${monthNames[today.getMonth()]} ${today.getFullYear()}`;

    const dow = (today.getDay()+6)%7; // Mon=0
    const mon = new Date(today);
    mon.setDate(today.getDate() - dow);

    const days = [];
    for(let i=0;i<5;i++){
      const d = new Date(mon);
      d.setDate(mon.getDate()+i);
      days.push(d);
    }

    const daysContainer = document.getElementById("calendarDays");
    daysContainer.innerHTML = "";

    days.forEach(d=>{
      const key = dateKeyLocal(d);
      const count = events.filter(ev => inRangeKey(key, ev.start, ev.end)).length;

      const cell = document.createElement("div");
      cell.className = "calendar-day";
      cell.textContent = d.getDate();

      if(key === todayKey) cell.classList.add("today");
      if(count > 0){
        cell.classList.add("has-event");
        const badge = document.createElement("div");
        badge.className = "day-badge";
        badge.textContent = String(count);
        cell.appendChild(badge);
      }

      cell.addEventListener("click", (e)=>{
        openPopupForDate(key);
        e.stopPropagation();
      });

      daysContainer.appendChild(cell);
    });
  }

  function buildCalendarMonth(){
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth();
    const todayKey = dateKeyLocal(today);

    const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
    document.getElementById("calendarMonthLabel").textContent = `${monthNames[month]} ${year}`;

    const firstOfMonth = new Date(year, month, 1);
    const lastOfMonth  = new Date(year, month + 1, 0);

    const daysContainer = document.getElementById("calendarDays");
    daysContainer.innerHTML = "";

    let start = new Date(firstOfMonth);
    const startDow = (start.getDay()+6)%7;
    start.setDate(start.getDate()-startDow);

    let end = new Date(lastOfMonth);
    const endDow = (end.getDay()+6)%7;
    end.setDate(end.getDate() + (4 - endDow)); // Fri

    let d = new Date(start);
    while(d <= end){
      const wd = d.getDay();
      if(wd >= 1 && wd <= 5){
        const key = dateKeyLocal(d);
        const count = events.filter(ev => inRangeKey(key, ev.start, ev.end)).length;

        const cell = document.createElement("div");
        cell.className = "calendar-day";
        if(d.getMonth() !== month) cell.classList.add("other-month");
        cell.textContent = d.getDate();

        if(key === todayKey) cell.classList.add("today");
        if(count > 0){
          cell.classList.add("has-event");
          const badge = document.createElement("div");
          badge.className = "day-badge";
          badge.textContent = String(count);
          cell.appendChild(badge);
        }

        if(d.getMonth() === month){
          cell.addEventListener("click", (e)=>{ openPopupForDate(key); e.stopPropagation(); });
        }else{
          cell.style.pointerEvents = "none";
        }

        daysContainer.appendChild(cell);
      }
      d.setDate(d.getDate()+1);
    }
  }

  calendarWidget.addEventListener("click", (e)=> e.stopPropagation());
  calendarWidget.addEventListener("mouseleave", () => {
    closePopup();
    hideCalendar();
  });

  document.addEventListener("click", (e)=>{
    const t = e.target;

    const clickedInsideCalendar = calendarWidget.contains(t);
    const clickedAdminBtn = adminEventBtn.contains(t);

    if(calendarWidget.classList.contains("visible") && !clickedInsideCalendar && !clickedAdminBtn){
      closePopup();
      hideCalendar();
    }
  });

  /* ======================
     init
     ====================== */
  loadEventsFromSheet();
  buildCalendar();
  updateTodayBadge();
</script>
</body>
</html>
